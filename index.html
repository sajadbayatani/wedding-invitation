<!doctype html>
<html lang="fa" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>کارت دعوت عروسی</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pinyon+Script&family=Vazirmatn:wght@200;300;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400..700&display=swap" rel="stylesheet">

  <style>
    :root {
      /* NEW Soulful Palette */
      --bg-gradient-start: #fdfbf7; 
      --bg-gradient-end: #f7f0eb;   
      
      /* Accents */
      --accent-sage: #8F9E8B;       
      --accent-blush: #dcb3a3;      
      
      /* Gold tones */
      --gold-dark: #9e7c3d;
      --gold-main: #d4af37;
      
      /* Text */
      --text-dark: #544a3d; 
      --text-light: #91877a;
      
      --app-height: 100vh;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body, html {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      font-family: 'Vazirmatn', sans-serif;
      overflow: hidden;
      background-color: #1a1a1a;
    }

    /* --- The Stage --- */
    .stage {
    position: relative;
    width: 100%;
    height: 100%;
    max-width: 450px; 
    aspect-ratio: 9 / 16;
    margin: 0 auto;
   
    background-repeat: no-repeat;
    background-position: center center;
    background-image: url('https://pub-7bdfce623edd4830ba01770010b68158.r2.dev/IMG_F40F6E5B3F07-1.jpeg');
    background-size: cover; 

    overflow: hidden;
    box-shadow: 0 0 60px rgba(0,0,0,0.6);
    }

    /* --- Textures & Florals --- */
    .floral-decor { position: absolute; pointer-events: none; z-index: 4; opacity: 0.9; filter: contrast(0.95) sepia(0.1); transition: transform 6s ease-in-out; }
    
    /* --- Typography & Effects --- */
    .gold-text { background: #ad8748; -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0px 2px 5px rgba(160, 130, 100, 0.1); font-weight: 700; }
    .green-text { background: #397266; -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0px 2px 5px rgba(160, 130, 100, 0.1); font-weight: 700; }
    h1, h2, h3 { margin: 0; color: var(--text-dark); }
    .title-small { font-size: 1.15rem; font-weight: 300; letter-spacing: 0.5px; }
    .title-large { font-size: 2.8rem; margin: 8px 0; }
    .subtitle { font-size: 1rem; color: var(--text-light); font-weight: 300; margin-top: 8px;}
    .latin-decor { font-family: 'Pinyon Script', cursive; font-size: 2.6rem; color: var(--accent-sage); margin-bottom: -15px; display: block; opacity: 0.8; }
    .particles-container { position: absolute; inset: 0; overflow: hidden; z-index: 1; }
    .particle { position: absolute; border-radius: 50%; background: rgba(220, 190, 160, 0.4); box-shadow: 0 0 8px rgba(220, 190, 160, 0.3); animation: floatUp linear infinite; }
    @keyframes floatUp { 0% { transform: translateY(100vh) scale(0.5); opacity: 0; } 20% { opacity: 0.7; } 100% { transform: translateY(-10vh) scale(1.1); opacity: 0; } }
    .scene { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 30px; z-index: 5; opacity: 0; pointer-events: none; transition: opacity 1.4s cubic-bezier(0.22, 1, 0.36, 1); }
    .scene.active { opacity: 1; pointer-events: auto; }
    .anim-up { opacity: 0; transform: translateY(35px); transition: all 1.1s ease-out; }
    .anim-scale { opacity: 0; transform: scale(0.85); transition: all 1.3s ease-out; }
    .anim-blur { opacity: 0; filter: blur(12px); transition: all 1.3s ease; }
    .active .anim-up { opacity: 1; transform: translateY(0); }
    .active .anim-scale { opacity: 1; transform: scale(1); }
    .active .anim-blur { opacity: 1; filter: blur(0); }
    .d-1 { transition-delay: 0.2s; } .d-2 { transition-delay: 0.7s; } .d-3 { transition-delay: 1.2s; }
    .gold-separator { height: 1px; width: 50px; background: linear-gradient(90deg, transparent, var(--accent-sage), transparent); margin: 20px auto; opacity: 0.6; }
    .map-row { display: flex; gap: 22px; margin-top: 30px; justify-content: center; }
    .map-btn { width: 52px; height: 52px; border-radius: 50%; background: rgba(255,255,255,0.8); border: 1px solid rgba(212, 175, 55, 0.3); display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 20px rgba(160, 140, 110, 0.15); transition: all 0.3s ease; cursor: pointer; color: var(--accent-sage); text-decoration: none; }
    .map-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 25px rgba(160, 140, 110, 0.25); color: var(--gold-dark); }
    .map-btn:active { transform: scale(0.95); }
    .map-btn svg { width: 24px; height: 24px; fill: currentColor; }
    .rsvp-btn { margin-top: 35px; padding: 14px 45px; border: none; background: linear-gradient(135deg, #c49a45, #e6c888); color: white; font-family: 'Vazirmatn'; font-weight: 500; font-size: 1.05rem; letter-spacing: 1px; border-radius: 50px; box-shadow: 0 12px 30px rgba(196, 154, 69, 0.3); cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .rsvp-btn:hover { transform: translateY(-2px); box-shadow: 0 15px 35px rgba(196, 154, 69, 0.4); }
    #confetti { position: absolute; inset: 0; pointer-events: none; z-index: 20; }

    /* --- Audio & Navigation Control Styling --- */
    .audio-control {
        position: absolute;
        top: 30px;
        right: 30px;
        z-index: 15;
    }

    /* Shared style for all round glass buttons (Audio + Nav) */
    .glass-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(143, 158, 139, 0.3); /* Sage border */
        color: var(--accent-sage);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, background 0.2s;
        opacity: 0.8;
    }
    .glass-btn:hover {
        opacity: 1;
        background: rgba(255, 255, 255, 0.9);
        color: var(--gold-dark);
    }
    .glass-btn svg {
        width: 18px;
        height: 18px;
        fill: currentColor;
    }
    .glass-btn:active {
        transform: scale(0.95);
    }

    /* Specific Audio rotation */
    .glass-btn.playing svg.play-icon {
        transform: rotate(3deg);
    }

    /* Navigation Container */
    .nav-controls {
        position: absolute;
        bottom: 30px;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 25px; /* Space between buttons */
        z-index: 15;
    }

  </style>
</head>
<body>

<div class="stage">
  <div class="noise-overlay"></div>
  <div class="vignette"></div>
  <div class="floral-decor floral-tl"></div>
  <div class="floral-decor floral-br"></div>
  <div class="particles-container" id="particles"></div>
  <canvas id="confetti"></canvas>

  <div class="audio-control">
      <button id="audioButton" class="glass-btn" aria-label="Play/Pause Music" onclick="toggleAudio()">
          <svg id="muteIcon" viewBox="0 0 24 24" style="display: block;">
              <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .9-.23 1.75-.63 2.52l1.42 1.42C20.5 15.46 21 13.82 21 12c0-4.28-3.3-7.72-7.5-8.15v2.09c3.13.37 5.5 3.1 5.5 6.06zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-9.27l4.16 4.16c-.49.33-1.05.57-1.66.71v2.09c1.69-.47 3.02-1.83 3.71-3.46l2.12 2.12c-1.35 1.69-3.4 2.76-5.64 3.08v2.09c3.61-.45 6.48-3.42 7.24-7.04L21 19.73 19.73 21 12 13.27 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
          </svg>
          <svg id="playIcon" class="play-icon" viewBox="0 0 24 24" style="display: none;">
              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.81 5 3.53 5 6.71s-2.11 5.9-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
          </svg>
      </button>
  </div>
  
  <div class="nav-controls">
      <button class="glass-btn" onclick="manualNavigate(1)" aria-label="Next Page">
          <svg viewBox="0 0 24 24">
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          </svg>
      </button>

      <button class="glass-btn" onclick="manualNavigate(-1)" aria-label="Previous Page">
        <svg viewBox="0 0 24 24">
              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
          </svg>
      </button>
  </div>
  
  <audio id="backgroundAudio" loop preload="auto">
      <source src="https://pub-7bdfce623edd4830ba01770010b68158.r2.dev/I-Feel-Alive.mp3" type="audio/mp3"> 
      Your browser does not support the audio element.
  </audio>


  <div class="scene" id="scene-1">
    <div class="anim-blur d-2">
        <span class="latin-decor" style="font-family: 'Noto Nastaliq Urdu';">یا لطیف</span>
    </div>
    <div class="gold-separator anim-blur d-2"></div>
    <h1 class="title-large green-text anim-blur d-2" style="font-family: 'Noto Nastaliq Urdu';">فاطمه و سجاد</h1>
    <h3 class="title-small anim-blur d-2" style="font-family: 'Noto Nastaliq Urdu';">همتم بدرقهٔ راه کن ای طایرِ قدس<br> که دراز است رَهِ مقصد و من نوسفرم</h3>

  </div>
  <div class="scene" id="scene-2">
    <h3 class="title-small anim-blur d-2" style="color: var(--accent-sage)">زمان</h3>
    <div class="gold-separator anim-blur d-2"></div>
    <div class="title-large green-text anim-blur d-2" dir="rtl" style="font-feature-settings: 'ss01'; font-family: 'Noto Nastaliq Urdu';">۴ دی‌ماه ۱۴۰۴</div>
    <div class="title-small anim-blur d-3" style="margin-top: 15px; letter-spacing: 2px; font-family: 'Noto Nastaliq Urdu';">از ساعت ۷ عصر</div>
  </div>
  <div class="scene" id="scene-3">
    <h3 class="title-small anim-blur d-2" style="color: var(--accent-sage)">مکان </h3>
    <div class="gold-separator anim-blur d-2"></div>
    <h2 class="green-text anim-blur d-2" style="font-size: 1.7rem; margin-top:10px; font-family: 'Noto Nastaliq Urdu';">تالار پذیرایی دریا پلاس</h2>
    <p class="title-small anim-blur d-2" style="font-family: 'Noto Nastaliq Urdu';">تهران، خیابان پاسداران، نرسیده به میدان نوبنیاد</p>
    <div class="map-row anim-scale d-3">
        <!-- <a href="https://waze.com/ul?ll=35.7833,51.3750&navigate=yes" target="_blank" class="map-btn" aria-label="Motehri on Waze"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></a> -->
        <a href="https://www.google.com/maps/search/?api=1&query=تالار+پذیرایی+دریا+پلاس،+تهران" target="_blank" class="map-btn" aria-label="Google Maps"><svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg></a>
    </div>
  </div>
  <div class="scene" id="scene-4">
    <div class="anim-blur d-2"><span class="latin-decor" style="font-size:3rem;">Save The Date</span></div>
    <div class="gold-separator anim-blur d-2"></div>
    <h1 class="green-text anim-blur d-2" style="font-size: 1.6rem; line-height: 2; font-family: 'Noto Nastaliq Urdu';">قدوم مبارک‌تان روشنایی بخش این روز فرخنده است</h1>
    <p class="title-small anim-blur d-3" style="margin-top:20px; color: var(--accent-sage); font-family: 'Noto Nastaliq Urdu';">خانواده‌های<br> بیاتانی و لقاء</p>
  </div>

</div>

<script>
  // Configuration
  const sceneDurations = [8000, 7000, 9000, 8000];
  const scenes = document.querySelectorAll('.scene');
  const audio = document.getElementById('backgroundAudio');
  const audioButton = document.getElementById('audioButton');
  const playIcon = document.getElementById('playIcon');
  const muteIcon = document.getElementById('muteIcon');
  
  // Navigation State
  let currentSceneIndex = 0;
  let autoSlideTimer = null;
  let isAutoPlayActive = true;
  
  // Set initial volume
  audio.volume = 0.3;

  function updateAudioButton(isPlaying) {
    if (isPlaying) {
      playIcon.style.display = 'block';
      muteIcon.style.display = 'none';
      audioButton.classList.add('playing');
      audioButton.ariaLabel = 'Mute Music';
    } else {
      playIcon.style.display = 'none';
      muteIcon.style.display = 'block';
      audioButton.classList.remove('playing');
      audioButton.ariaLabel = 'Play Music';
    }
  }

  function toggleAudio() {
    if (audio.paused) {
      audio.play().then(() => {
        updateAudioButton(true);
      }).catch(error => {
        console.error("Audio playback failed:", error);
        alert("لطفاً برای پخش موسیقی اجازه دهید.");
      });
    } else {
      audio.pause();
      updateAudioButton(false);
    }
  }

  // --- Logic for Manual Navigation ---
  function manualNavigate(direction) {
    // Disable auto play flag
    isAutoPlayActive = false;
    
    // Clear any pending auto-slide timer
    if (autoSlideTimer) {
        clearTimeout(autoSlideTimer);
    }

    // Calculate new index
    let newIndex = currentSceneIndex + direction;

    // Check bounds (Looping vs Clamping - here we Clamp/Stop at ends)
    if (newIndex < 0) newIndex = 0;
    if (newIndex >= scenes.length) newIndex = scenes.length - 1;

    // Only move if index actually changed
    if (newIndex !== currentSceneIndex) {
        playScene(newIndex);
    }
  }

  // --- Scene Sequencer ---
  function playScene(index) {
    // Update State
    currentSceneIndex = index;
    
    // Clear previous classes
    scenes.forEach(s => s.classList.remove('active'));
    
    // Activate new scene
    scenes[index].classList.add('active');

    // Trigger Effects
    if (index === scenes.length - 1) { 
        createConfetti(); 
        updateConfetti(); 
    }

    // If AutoPlay is still active, schedule next slide
    if (isAutoPlayActive && index < scenes.length - 1) {
        autoSlideTimer = setTimeout(() => { 
            playScene(index + 1); 
        }, sceneDurations[index]); 
    }
  }

  // Placeholders for effects (Assuming logic exists in full version or removed for brevity)
  function createParticles() { /* ... */ }
  function createConfetti() { /* ... */ }
  function updateConfetti() { /* ... */ }


  document.addEventListener('DOMContentLoaded', () => {
    createParticles();
    
    // Start sequence after slight delay
    setTimeout(() => { playScene(0); }, 1000); 

    updateAudioButton(false);
    
    // Attempt silent playback setup
    audio.muted = true;
    audio.play().catch(() => {}); 
    audio.muted = false; 
  });
  // --- New Startup Logic to Handle Autoplay Restrictions ---
  let hasUserInteracted = false;

  function handleFirstInteraction() {
    if (hasUserInteracted) return;
    hasUserInteracted = true;
    
    // Attempt to play only if it's paused/ready
    if (audio.paused) {
      // We don't call toggleAudio here, we just make sure the audio element is ready for playback
      // The user still has to click the specific audio button to play/mute manually.
      audio.load();
    }
    
    // Start the scene sequence
    setTimeout(() => { playScene(0); }, 1000); 

    // Remove this listener after the first interaction
    document.removeEventListener('click', handleFirstInteraction);
    document.removeEventListener('touchstart', handleFirstInteraction);
  }

  document.addEventListener('DOMContentLoaded', () => {
    createParticles();
    updateAudioButton(false); // Ensure the mute icon is shown initially
    
    // Attach event listeners for the first user interaction
    document.addEventListener('click', handleFirstInteraction, { once: true });
    document.addEventListener('touchstart', handleFirstInteraction, { once: true });
    
    // If the browser supports the 'canplaythrough' event, we can try to load early
    audio.addEventListener('canplaythrough', () => {
        audio.load();
    }, { once: true });
  });
</script>
</body>
</html>
